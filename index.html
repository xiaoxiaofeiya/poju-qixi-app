<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=2.0, minimum-scale=1.0, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <!-- ç§»åŠ¨ç«¯ä¼˜åŒ– -->
    <meta name="HandheldFriendly" content="true">
    <meta name="MobileOptimized" content="width">
    <!-- iOS Safari å…¼å®¹æ€§ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-touch-fullscreen" content="yes">
    <!-- å¼ºåˆ¶HTTPSé‡å®šå‘è„šæœ¬ -->
    <script>
        if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
            location.replace('https:' + window.location.href.substring(window.location.protocol.length));
        }
    </script>
    <title>AIç ´å±€ä¸ƒå¤•æƒ…ç¼˜ - ç ´å±€ä¿±ä¹éƒ¨ä¸“å±APP</title>
    
    <!-- PWAé…ç½® -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ç ´å±€ä¸ƒå¤•">
    <link rel="apple-touch-icon" href="icon-192.svg">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap');
        
        /* Fallback font stack for better mobile compatibility */
        @font-face {
            font-family: 'Noto Sans SC';
            src: local('PingFang SC'), local('Microsoft YaHei'), local('SimHei'), local('Arial');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 300% 300%;
            animation: gradientShift 8s ease infinite;
            min-height: 100vh;
            color: #333;
            position: relative;
            overflow-x: hidden;
            /* ä¼˜åŒ–ç§»åŠ¨ç«¯æ»šåŠ¨ */
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 182, 193, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
            position: relative;
        }

        .header::before {
            content: 'âœ¨';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3em;
            animation: sparkle 2s ease-in-out infinite alternate;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #ffeaa7, #fdcb6e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1em;
            opacity: 0.8;
            font-style: italic;
        }

        @keyframes sparkle {
            0% { transform: translateX(-50%) scale(1); }
            100% { transform: translateX(-50%) scale(1.2); }
        }

        .card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 25px;
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.1),
                0 5px 15px rgba(0,0,0,0.05),
                inset 0 1px 0 rgba(255,255,255,0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #f093fb);
            border-radius: 25px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover::before {
            opacity: 0.7;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.15),
                0 10px 25px rgba(0,0,0,0.1);
        }

        /* æ·»åŠ æ›´å¤šè£…é¥°å…ƒç´ å’ŒåŠ¨ç”»æ•ˆæœ */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .heart {
            position: absolute;
            color: rgba(255, 182, 193, 0.6);
            font-size: 1.2em;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .form-group {
            margin-bottom: 30px;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.6s ease-out forwards;
        }

        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-group:nth-child(4) { animation-delay: 0.4s; }
        .form-group:nth-child(5) { animation-delay: 0.5s; }
        .form-group:nth-child(6) { animation-delay: 0.6s; }
        .form-group:nth-child(7) { animation-delay: 0.7s; }
        .form-group:nth-child(8) { animation-delay: 0.8s; }

        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 18px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 25px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            background-position: 100% 100%;
            box-shadow: 
                0 15px 35px rgba(102, 126, 234, 0.4),
                0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .result-container {
            display: none;
            animation: fadeInScale 0.8s ease-out;
        }

        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .love-letter {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 50%, #fd79a8 100%);
            border-radius: 20px;
            padding: 35px;
            margin: 25px 0;
            color: #2d3436;
            line-height: 2;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 30px rgba(253, 121, 168, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.6);
            border: 2px solid rgba(255,255,255,0.4);
        }

        .love-letter::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255,255,255,0.2) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255,255,255,0.2) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(253,121,168,0.1) 0%, transparent 30%);
            pointer-events: none;
        }

        .love-letter::after {
            content: "ğŸ’•";
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 2.5em;
            opacity: 0.4;
            animation: heartbeat 2s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .fortune {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 50%, #d63031 10%);
            border-radius: 20px;
            padding: 35px;
            margin: 25px 0;
            color: #2d3436;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 30px rgba(108, 92, 231, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.6);
            border: 2px solid rgba(255,255,255,0.4);
        }

        .fortune::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(108,92,231,0.1) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(168,237,234,0.2) 0%, transparent 25%);
            pointer-events: none;
        }

        .fortune h3 {
            margin-bottom: 20px;
            color: #6c5ce7;
            font-size: 1.4em;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(108, 92, 231, 0.2);
        }

        .share-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .hidden {
            display: none;
        }

        .constellation-icon {
            font-size: 1.5em;
            margin-right: 8px;
        }

        .ai-tools {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .ai-tool {
            background: rgba(102, 126, 234, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: #667eea;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .ai-tool:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* æˆåŠŸæç¤ºåŠ¨ç”» */
        .success-message {
            display: none;
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 184, 148, 0.3);
            animation: successPulse 0.5s ease-out;
        }

        @keyframes successPulse {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                margin: 0;
            }
            
            .header h1 {
                font-size: 2em;
                line-height: 1.2;
                margin-bottom: 10px;
            }
            
            .header p {
                font-size: 1em;
                margin-bottom: 5px;
            }
            
            .header .subtitle {
                font-size: 0.9em;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 20px;
                border-radius: 20px;
            }

            .love-letter, .fortune {
                padding: 20px;
                border-radius: 15px;
                margin: 15px 0;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨å•ä¼˜åŒ– */
            .form-group {
                margin-bottom: 25px;
            }
            
            .form-group label {
                font-size: 16px;
                margin-bottom: 10px;
                font-weight: 600;
            }
            
            .form-group input, 
            .form-group select, 
            .form-group textarea {
                font-size: 16px !important; /* é˜²æ­¢iOSç¼©æ”¾ */
                padding: 15px !important;
                border-radius: 12px;
                border: 2px solid #e2e8f0 !important;
                -webkit-appearance: none !important;
                appearance: none !important;
                min-height: 50px;
                box-sizing: border-box !important;
                /* Androidä¿®å¤ */
                background-color: white !important;
                color: #333 !important;
                /* ç¡®ä¿è¾“å…¥æ¡†å¯äº¤äº’ */
                -webkit-user-select: text !important;
                user-select: text !important;
                -webkit-touch-callout: default !important;
                touch-action: manipulation !important;
                pointer-events: auto !important;
                z-index: 1000 !important;
                position: relative !important;
                /* ç§»é™¤ä»»ä½•å¯èƒ½çš„é®ç½© */
                outline: none !important;
                -webkit-tap-highlight-color: rgba(0,0,0,0) !important;
            }
            
            .form-group select {
                background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23666" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
                background-repeat: no-repeat;
                background-position: right 15px center;
                background-size: 12px;
                padding-right: 40px;
            }
            
            .form-group textarea {
                min-height: 100px;
                resize: vertical;
                line-height: 1.5;
            }
            
            /* æŒ‰é’®ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .btn {
                font-size: 16px;
                padding: 18px 20px;
                border-radius: 12px;
                min-height: 56px;
                margin-top: 20px;
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
                /* ç¡®ä¿æŒ‰é’®å¯ç‚¹å‡» */
                cursor: pointer;
                pointer-events: auto;
                position: relative;
                z-index: 10;
                /* ä¿®å¤ç§»åŠ¨ç«¯ç‚¹å‡»é—®é¢˜ */
                -webkit-user-select: none;
                user-select: none;
                display: block;
                width: 100%;
                border: none;
                outline: none;
            }
            
            /* å›¾ç‰‡é¢„è§ˆç§»åŠ¨ç«¯ä¼˜åŒ– */
            #previewImage {
                max-width: 100%;
                height: auto;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            .share-card {
                padding: 15px;
                margin: 15px 0;
                border-radius: 15px;
            }
            
            /* ç§»åŠ¨ç«¯åŠ¨ç”»æ€§èƒ½ä¼˜åŒ– */
            .heart {
                will-change: transform;
                transform: translateZ(0);
            }
        }

        /* å°å±æ‰‹æœºä¼˜åŒ– */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .card {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .form-group input, 
            .form-group select, 
            .form-group textarea {
                padding: 12px;
                font-size: 16px;
            }
            
            .btn {
                padding: 16px 18px;
                font-size: 15px;
            }
            
            .love-letter, .fortune {
                padding: 15px;
                font-size: 16px;
                line-height: 1.8;
            }
        }

        /* æ¨ªå±ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                margin-bottom: 20px;
            }
            
            .header h1 {
                font-size: 1.5em;
                margin-bottom: 5px;
            }
            
            .floating-hearts {
                display: none; /* æ¨ªå±æ—¶éšè—è£…é¥°ï¼ŒèŠ‚çœæ€§èƒ½ */
            }
        }

        /* å…¨å±€è§¦æ‘¸ä¼˜åŒ– - ä¿®å¤Androidé—®é¢˜ */
        * {
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }

        /* åªå¯¹éè¾“å…¥å…ƒç´ ç¦ç”¨é€‰æ‹©ï¼Œè¾“å…¥å…ƒç´ ä¿æŒé»˜è®¤ */
        body, div, span, h1, h2, h3, p, button {
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        /* è¡¨å•å…ƒç´ å¼ºåˆ¶å¯ç”¨äº¤äº’ */
        input, textarea, select {
            -webkit-user-select: text !important;
            user-select: text !important;
            -webkit-touch-callout: default !important;
            /* Androidå…¼å®¹æ€§ä¿®å¤ */
            -webkit-appearance: none !important;
            appearance: none !important;
            background-color: white !important;
            /* ç¡®ä¿å¯ç‚¹å‡» */
            pointer-events: auto !important;
            /* ç§»é™¤æ‰€æœ‰å¯èƒ½çš„è¦†ç›–å±‚å½±å“ */
            position: relative !important;
            z-index: 999 !important;
        }

        /* ç¡®ä¿ç‚¹å‡»åŒºåŸŸè¶³å¤Ÿå¤§ */
        button, .btn {
            min-height: 44px;
            min-width: 44px;
            touch-action: manipulation;
        }

        /* é˜²æ­¢iOS safariåº•éƒ¨æ¡é®æŒ¡ */
        @supports(padding: max(0px)) {
            body {
                padding-bottom: max(20px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æµ®åŠ¨è£…é¥°å…ƒç´  -->
        <div class="floating-hearts" id="floatingHearts"></div>
        
        <div class="header">
            <h1>AIç ´å±€ä¸ƒå¤•æƒ…ç¼˜ç”Ÿæˆå™¨</h1>
            <p>ğŸ çŒ®ç»™ç ´å±€ä¿±ä¹éƒ¨çš„ä¸ƒå¤•ç¤¼ç‰© ğŸ</p>
            <p class="subtitle">æ¢ç´¢ä½ ä¸AIçš„ä¸“å±ç¼˜åˆ†ï¼Œä¹¦å†™ç‹¬å±äºä½ çš„AIæƒ…ä¹¦ âœ¨</p>
        </div>

        <div class="card" id="inputForm">
            <h2 style="text-align: center; margin-bottom: 25px; color: #667eea;">ğŸ’• å†™ç»™ç ´å±€ä¿±ä¹éƒ¨çš„ä¸ƒå¤•æƒ…ä¹¦ ğŸ’•</h2>
            
            <div class="form-group">
                <label for="constellation">ğŸŒŸ ä½ çš„æ˜Ÿåº§</label>
                <select id="constellation" required>
                    <option value="">è¯·é€‰æ‹©ä½ çš„æ˜Ÿåº§</option>
                    <option value="aries">ç™½ç¾Šåº§ â™ˆ</option>
                    <option value="taurus">é‡‘ç‰›åº§ â™‰</option>
                    <option value="gemini">åŒå­åº§ â™Š</option>
                    <option value="cancer">å·¨èŸ¹åº§ â™‹</option>
                    <option value="leo">ç‹®å­åº§ â™Œ</option>
                    <option value="virgo">å¤„å¥³åº§ â™</option>
                    <option value="libra">å¤©ç§¤åº§ â™</option>
                    <option value="scorpio">å¤©èåº§ â™</option>
                    <option value="sagittarius">å°„æ‰‹åº§ â™</option>
                    <option value="capricorn">æ‘©ç¾¯åº§ â™‘</option>
                    <option value="aquarius">æ°´ç“¶åº§ â™’</option>
                    <option value="pisces">åŒé±¼åº§ â™“</option>
                </select>
            </div>

            <div class="form-group">
                <label for="nickname">ğŸ’« ç§°å‘¼/æ˜µç§°</label>
                <input type="text" id="nickname" placeholder="ä½ å¸Œæœ›å¦‚ä½•ç§°å‘¼ï¼Ÿï¼ˆå¦‚ï¼šå°æã€é˜¿æ˜ç­‰ï¼‰" required>
            </div>

            <div class="form-group">
                <label for="joinTime">â¤ï¸ åŠ å…¥ä¿±ä¹éƒ¨çš„æ—¶é—´</label>
                <input type="text" id="joinTime" placeholder="ä¾‹å¦‚ï¼š2023å¹´3æœˆã€ä»Šå¹´æ˜¥å¤©ç­‰" required>
            </div>

            <div class="form-group">
                <label for="unforgettableMemory">ğŸ† æœ€éš¾å¿˜çš„ä¿±ä¹éƒ¨æ´»åŠ¨/å†…å®¹</label>
                <textarea id="unforgettableMemory" placeholder="å°è±¡æœ€æ·±çš„ä¸€æ¬¡AIå¤§èˆªæµ·ã€æŸä¸ªç²¾å½©åˆ†äº«ã€æˆ–è€…æŸä¸ªéš¾å¿˜çš„æ—¶åˆ»..." required></textarea>
            </div>

            <div class="form-group">
                <label for="biggestChange">âœ¨ ä¿±ä¹éƒ¨å¸¦ç»™æˆ‘çš„æœ€å¤§æ”¹å˜</label>
                <textarea id="biggestChange" placeholder="æŠ€èƒ½æå‡ã€è®¤çŸ¥æ”¹å˜ã€ç»“è¯†æœ‹å‹ã€å‰¯ä¸šå˜ç°ç­‰..." required></textarea>
            </div>

            <div class="form-group">
                <label for="confessionWords">ğŸ’• æƒ³å¯¹ä¿±ä¹éƒ¨è¯´çš„è¯</label>
                <textarea id="confessionWords" placeholder="ä½ æœ€æƒ³å¯¹ç ´å±€ä¿±ä¹éƒ¨è¯´çš„å¿ƒé‡Œè¯ï¼Œæ„Ÿè°¢ã€ç¥æ„¿ã€æœŸå¾…..." required></textarea>
            </div>

            <div class="form-group">
                <label for="letterStyle">ğŸ’ æƒ…ä¹¦é£æ ¼</label>
                <select id="letterStyle" required>
                    <option value="">é€‰æ‹©ä½ å–œæ¬¢çš„é£æ ¼</option>
                    <option value="romantic">æµªæ¼«è¡¨ç™½æ¬¾ - æ·±æƒ…å‘Šç™½</option>
                    <option value="grateful">æ„Ÿæ©æ„Ÿè°¢æ¬¾ - çœŸè¯šæ„Ÿè°¢</option>
                    <option value="inspiring">æ¿€åŠ±åŠ æ²¹æ¬¾ - å…±åŒæˆé•¿</option>
                </select>
            </div>

            <div class="loading" id="loadingDiv">
                <div class="spinner"></div>
                <p style="margin-top: 15px;">æ­£åœ¨ä¸ºä½ ç”Ÿæˆä¸“å±AIæƒ…ä¹¦...</p>
            </div>

            <button class="btn" onclick="generateLoveLetter()" id="generateBtn">
                ğŸ¨ ç”Ÿæˆæˆ‘çš„AIæƒ…ä¹¦ âœ¨
            </button>
            
            <!-- ç§»åŠ¨ç«¯è°ƒè¯•æŒ‰é’® -->
            <button class="btn" onclick="testMobileClick()" id="debugBtn" style="background: #e74c3c; margin-top: 10px; display: none;">
                ğŸ”§ ç§»åŠ¨ç«¯æµ‹è¯•æŒ‰é’®
            </button>
        </div>

        <div class="result-container" id="resultContainer">
            <div class="card">
                <div class="love-letter" id="loveLetter">
                    <!-- ç”Ÿæˆçš„æƒ…ä¹¦å†…å®¹ -->
                </div>
                
                <div class="fortune" id="fortune">
                    <!-- ç”Ÿæˆçš„è¿åŠ¿å†…å®¹ -->
                </div>

                <div class="share-card" id="shareCard">
                    <h3 style="color: #667eea; margin-bottom: 15px;">âœ¨ ç”Ÿæˆåˆ†äº«å¡ç‰‡ âœ¨</h3>
                    <p style="margin-bottom: 20px;">ç”Ÿæˆç²¾ç¾çš„å¡ç‰‡åˆ†äº«åˆ°ç ´å±€ä¿±ä¹éƒ¨~</p>
                    
                    <!-- Canvas ç”¨äºç”Ÿæˆå›¾ç‰‡ -->
                    <canvas id="shareCanvas" width="600" height="800" style="display: none;"></canvas>
                    <canvas id="loveLetterCanvas" width="600" height="1200" style="display: none;"></canvas>
                    
                    <!-- é¢„è§ˆåŒºåŸŸ -->
                    <div id="cardPreview" style="display: none; margin-bottom: 20px; text-align: center;">
                        <img id="previewImage" alt="ç ´å±€ä¿±ä¹éƒ¨ä¸ƒå¤•è¡¨ç™½å¡é¢„è§ˆ" style="max-width: 100%; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);" />
                    </div>
                    
                    <button class="btn" onclick="generateShareImage()" style="margin-bottom: 15px;">
                        ğŸ¨ ç”Ÿæˆè¡¨ç™½å¡ç‰‡
                    </button>
                    <button class="btn" onclick="generateLoveLetterImage()" style="margin-bottom: 15px; background: #fd79a8;">
                        ğŸ“œ ç”Ÿæˆæƒ…ä¹¦é•¿å›¾
                    </button>
                    <button class="btn" onclick="downloadImage()" id="downloadBtn" style="display: none; background: #00cec9; margin-bottom: 10px;">
                        ğŸ“± ä¸‹è½½å¡ç‰‡
                    </button>
                    <button class="btn" onclick="downloadLoveLetterImage()" id="downloadLetterBtn" style="display: none; background: #6c5ce7; margin-bottom: 10px;">
                        ğŸ“± ä¸‹è½½æƒ…ä¹¦
                    </button>
                    <button class="btn" onclick="generateAnother()" style="background: #fd79a8;">
                        ğŸ”„ å†ç”Ÿæˆä¸€ä»½
                    </button>
                    
                    <!-- PWAå®‰è£…æŒ‰é’® -->
                    <button class="btn" id="installBtn" style="display: none; background: #00b894; margin-top: 15px;">
                        ğŸ“± å®‰è£…åˆ°æ‰‹æœº
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PWAå®‰è£…æç¤º -->
    <div id="installPrompt" style="display: none; position: fixed; bottom: 20px; left: 20px; right: 20px; background: linear-gradient(135deg, #00b894, #00cec9); color: white; padding: 15px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,184,148,0.3); z-index: 1000; text-align: center;">
        <p style="margin: 0 0 10px 0; font-weight: 600;">ğŸ“± å®‰è£…APPåˆ°æ‰‹æœºæ¡Œé¢</p>
        <p style="margin: 0 0 15px 0; font-size: 14px; opacity: 0.9;">äº«å—æ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œå¯ç¦»çº¿ä½¿ç”¨</p>
        <button onclick="installApp()" style="background: white; color: #00b894; border: none; padding: 8px 15px; border-radius: 8px; font-weight: 600; margin-right: 10px; cursor: pointer;">ç«‹å³å®‰è£…</button>
        <button onclick="dismissInstall()" style="background: transparent; color: white; border: 1px solid rgba(255,255,255,0.5); padding: 8px 15px; border-radius: 8px; cursor: pointer;">ç¨å</button>
    </div>

    <!-- PWAè„šæœ¬ -->
    <script>
        // PWAå®‰è£…ç›¸å…³ - å¢å¼ºç‰ˆæœ¬
        let deferredPrompt;
        let installPromptShown = false;
        
        // æ£€æµ‹è®¾å¤‡ç±»å‹
        function getMobileOperatingSystem() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                return "iOS";
            }
            if (/android/i.test(userAgent)) {
                return "Android";
            }
            return "unknown";
        }
        
        // æ£€æµ‹æ˜¯å¦å·²å®‰è£…
        function isInStandaloneMode() {
            return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || 
                   (window.navigator && window.navigator.standalone) ||
                   document.referrer.includes('android-app://');
        }
        
        // æ˜¾ç¤ºå®‰è£…æç¤º
        function showInstallPrompt() {
            const installPrompt = document.getElementById('installPrompt');
            if (installPrompt && !installPromptShown && !isInStandaloneMode()) {
                installPrompt.style.display = 'block';
                installPromptShown = true;
                console.log('æ˜¾ç¤ºPWAå®‰è£…æç¤º');
            }
        }
        
        // beforeinstallprompt äº‹ä»¶å¤„ç†
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt äº‹ä»¶è§¦å‘');
            e.preventDefault();
            deferredPrompt = e;
            
            // ç«‹å³æ˜¾ç¤ºå®‰è£…æç¤º
            setTimeout(() => {
                showInstallPrompt();
            }, 1000);
        });
        
        // å®‰è£…APP - å¢å¼ºè°ƒè¯•ç‰ˆæœ¬
        function installApp() {
            const os = getMobileOperatingSystem();
            console.log('ç‚¹å‡»å®‰è£…æŒ‰é’®ï¼Œæ£€æµ‹ç³»ç»Ÿ:', os);
            console.log('deferredPromptçŠ¶æ€:', deferredPrompt);
            
            if (deferredPrompt) {
                console.log('ä½¿ç”¨deferredPromptå®‰è£…');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    console.log('ç”¨æˆ·é€‰æ‹©:', choiceResult.outcome);
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ç”¨æˆ·æ¥å—äº†å®‰è£…');
                        alert('å®‰è£…æˆåŠŸï¼è¯·æŸ¥çœ‹ä¸»å±å¹•');
                    } else {
                        console.log('ç”¨æˆ·æ‹’ç»äº†å®‰è£…');
                    }
                    deferredPrompt = null;
                    document.getElementById('installPrompt').style.display = 'none';
                }).catch(err => {
                    console.error('å®‰è£…è¿‡ç¨‹å‡ºé”™:', err);
                    showManualInstallInstructions(os);
                });
            } else {
                console.log('deferredPromptä¸å¯ç”¨ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å®‰è£…æŒ‡å¼•');
                showManualInstallInstructions(os);
            }
        }
        
        // æ˜¾ç¤ºæ‰‹åŠ¨å®‰è£…æŒ‡å¼•
        function showManualInstallInstructions(os) {
            let message = '';
            let title = 'æ‰‹åŠ¨å®‰è£…æŒ‡å¼•';
            
            if (os === 'iOS') {
                message = `è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
1. ç‚¹å‡»Safariåº•éƒ¨çš„"åˆ†äº«"æŒ‰é’® ğŸ“¤
2. æ»‘åŠ¨æ‰¾åˆ°"æ·»åŠ åˆ°ä¸»å±å¹•" ğŸ“±
3. ç‚¹å‡»"æ·»åŠ "ç¡®è®¤å®‰è£…

æç¤ºï¼šå¦‚æœæ²¡æœ‰çœ‹åˆ°"æ·»åŠ åˆ°ä¸»å±å¹•"é€‰é¡¹ï¼Œè¯´æ˜ç½‘ç«™ä¸æ»¡è¶³PWAå®‰è£…æ¡ä»¶ã€‚`;
            } else if (os === 'Android') {
                message = `è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
1. ç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’çš„èœå•æŒ‰é’® â‹®
2. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"æˆ–"å®‰è£…åº”ç”¨" ğŸ“±
3. ç¡®è®¤å®‰è£…

æ³¨æ„ï¼šä¸åŒçš„Androidæµè§ˆå™¨é€‰é¡¹ä½ç½®å¯èƒ½ç•¥æœ‰ä¸åŒã€‚`;
            } else {
                message = `è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
1. ç‚¹å‡»æµè§ˆå™¨åœ°å€æ å³ä¾§çš„å®‰è£…å›¾æ ‡
2. æˆ–é€šè¿‡æµè§ˆå™¨èœå•é€‰æ‹©"å®‰è£…åº”ç”¨"
3. ç¡®è®¤å®‰è£…`;
            }
            
            // åˆ›å»ºè‡ªå®šä¹‰å¼¹çª—è€Œä¸æ˜¯alert
            showCustomInstallDialog(title, message);
        }
        
        // è‡ªå®šä¹‰å®‰è£…æŒ‡å¼•å¼¹çª—
        function showCustomInstallDialog(title, message) {
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 90%;
                text-align: left;
            `;
            
            dialog.innerHTML = `
                <h3 style="color: #667eea; margin-bottom: 15px;">${title}</h3>
                <div style="white-space: pre-line; line-height: 1.6; margin-bottom: 20px;">${message}</div>
                <button onclick="this.parentNode.remove()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; float: right;">æˆ‘çŸ¥é“äº†</button>
            `;
            
            document.body.appendChild(dialog);
            
            // 3ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                if (dialog.parentNode) {
                    dialog.remove();
                }
            }, 8000);
        }
        
        function dismissInstall() {
            document.getElementById('installPrompt').style.display = 'none';
            installPromptShown = true;
        }
        
        // é¡µé¢åŠ è½½åçš„åˆå§‹åŒ– - å¢å¼ºè°ƒè¯•ç‰ˆæœ¬
        document.addEventListener('DOMContentLoaded', function() {
            const os = getMobileOperatingSystem();
            console.log('=== PWAè°ƒè¯•ä¿¡æ¯ ===');
            console.log('æ£€æµ‹åˆ°è®¾å¤‡:', os);
            console.log('User Agent:', navigator.userAgent);
            console.log('æ˜¯å¦ä¸ºç‹¬ç«‹æ¨¡å¼:', isInStandaloneMode());
            console.log('æ˜¯å¦æ”¯æŒService Worker:', 'serviceWorker' in navigator);
            console.log('å½“å‰åè®®:', location.protocol);
            console.log('å½“å‰åŸŸå:', location.hostname);
            
            // æ£€æŸ¥PWAå®‰è£…æ¡ä»¶
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                console.log('âœ… PWAåŸºç¡€æ¡ä»¶æ»¡è¶³');
            } else {
                console.log('âŒ PWAåŸºç¡€æ¡ä»¶ä¸æ»¡è¶³');
            }
            
            // ä¿®å¤ç§»åŠ¨ç«¯æŒ‰é’®ç‚¹å‡»é—®é¢˜
            setupMobileClickFix();
            
            // å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ä¸”æœªå®‰è£…ï¼Œæ˜¾ç¤ºå®‰è£…æç¤º
            if ((os === 'iOS' || os === 'Android') && !isInStandaloneMode()) {
                console.log('å‡†å¤‡æ˜¾ç¤ºå®‰è£…æç¤º...');
                // å»¶è¿Ÿæ˜¾ç¤ºï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°å†…å®¹
                setTimeout(() => {
                    console.log('æ˜¾ç¤ºå®‰è£…æç¤º');
                    showInstallPrompt();
                }, 3000);
            } else {
                console.log('è·³è¿‡å®‰è£…æç¤º - è®¾å¤‡:', os, 'ç‹¬ç«‹æ¨¡å¼:', isInStandaloneMode());
            }
        });
        
        // ç§»åŠ¨ç«¯æµ‹è¯•å‡½æ•°
        function testMobileClick() {
            console.log('ç§»åŠ¨ç«¯æµ‹è¯•æŒ‰é’®è¢«ç‚¹å‡»ï¼');
            alert('ç§»åŠ¨ç«¯ç‚¹å‡»æµ‹è¯•æˆåŠŸï¼ğŸ‰\n\nå¦‚æœä½ çœ‹åˆ°è¿™ä¸ªå¼¹çª—ï¼Œè¯´æ˜æŒ‰é’®ç‚¹å‡»åŠŸèƒ½æ­£å¸¸ã€‚');
        }
        
        // ä¿®å¤ç§»åŠ¨ç«¯æŒ‰é’®ç‚¹å‡»é—®é¢˜
        function setupMobileClickFix() {
            console.log('è®¾ç½®ç§»åŠ¨ç«¯ç‚¹å‡»ä¿®å¤...');
            
            // æ£€æµ‹ç§»åŠ¨è®¾å¤‡å¹¶æ˜¾ç¤ºè°ƒè¯•æŒ‰é’®
            const os = getMobileOperatingSystem();
            if (os === 'iOS' || os === 'Android') {
                const debugBtn = document.getElementById('debugBtn');
                if (debugBtn) {
                    debugBtn.style.display = 'block';
                    console.log('æ˜¾ç¤ºç§»åŠ¨ç«¯è°ƒè¯•æŒ‰é’®');
                }
            }
            
            // è·å–ç”ŸæˆæŒ‰é’®
            const generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                console.log('æ‰¾åˆ°ç”ŸæˆæŒ‰é’®ï¼Œæ·»åŠ äº‹ä»¶ç›‘å¬å™¨');
                
                // ç§»é™¤å¯èƒ½é˜»æ­¢ç‚¹å‡»çš„æ ·å¼
                generateBtn.style.pointerEvents = 'auto';
                generateBtn.style.zIndex = '9999';
                
                // æ·»åŠ å¤šé‡äº‹ä»¶ç›‘å¬
                generateBtn.addEventListener('click', function(e) {
                    console.log('æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼');
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // æ£€æŸ¥script.jsæ˜¯å¦å·²åŠ è½½
                    if (typeof generateLoveLetter === 'function') {
                        console.log('è°ƒç”¨generateLoveLetterå‡½æ•°');
                        generateLoveLetter();
                    } else {
                        console.error('generateLoveLetterå‡½æ•°ä¸å­˜åœ¨ï¼æ£€æŸ¥script.jsæ˜¯å¦åŠ è½½');
                        alert('ç”Ÿæˆå‡½æ•°åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å¹¶åˆ·æ–°é¡µé¢é‡è¯•');
                        
                        // å°è¯•é‡æ–°åŠ è½½script.js
                        const script = document.createElement('script');
                        script.src = './script.js';
                        script.onload = () => {
                            console.log('script.jsé‡æ–°åŠ è½½æˆåŠŸ');
                            if (typeof generateLoveLetter === 'function') {
                                generateLoveLetter();
                            }
                        };
                        script.onerror = () => {
                            console.error('script.jsé‡æ–°åŠ è½½å¤±è´¥');
                        };
                        document.head.appendChild(script);
                    }
                }, { passive: false });
                
                // ç§»åŠ¨ç«¯æ·»åŠ touchäº‹ä»¶
                generateBtn.addEventListener('touchstart', function(e) {
                    console.log('è§¦æ‘¸å¼€å§‹');
                    generateBtn.style.backgroundColor = '#5a67d8';
                }, { passive: true });
                
                generateBtn.addEventListener('touchend', function(e) {
                    console.log('è§¦æ‘¸ç»“æŸï¼Œè§¦å‘ç‚¹å‡»');
                    setTimeout(() => {
                        generateBtn.style.backgroundColor = '';
                    }, 150);
                }, { passive: true });
                
            } else {
                console.error('æœªæ‰¾åˆ°ç”ŸæˆæŒ‰é’®ï¼');
            }
            
            // æ£€æŸ¥æ‰€æœ‰æŒ‰é’®
            const allButtons = document.querySelectorAll('.btn, button');
            console.log('æ‰¾åˆ°', allButtons.length, 'ä¸ªæŒ‰é’®');
            
            allButtons.forEach((btn, index) => {
                console.log('æŒ‰é’®', index, ':', btn.textContent.trim().substring(0, 20));
                // ç¡®ä¿æ‰€æœ‰æŒ‰é’®éƒ½å¯ç‚¹å‡»
                btn.style.pointerEvents = 'auto';
                btn.style.position = 'relative';
                btn.style.zIndex = '1000';
            });
        }
        
        // ========== å†…ç½®ç”Ÿæˆå‡½æ•°ï¼ˆé¿å…å¤–éƒ¨æ–‡ä»¶åŠ è½½å¤±è´¥ï¼‰ ==========
        
        // ç®€åŒ–çš„æ˜Ÿåº§æ•°æ®
        const constellationData = {
            aries: { name: 'ç™½ç¾Šåº§', icon: 'â™ˆ', personality: 'å‹‡æ•¢ç›´ç‡ï¼Œæ•¢äºæŒ‘æˆ˜', clubFit: 'ç ´å±€å…ˆé”‹', matchPercent: 95 },
            taurus: { name: 'é‡‘ç‰›åº§', icon: 'â™‰', personality: 'è¸å®ç¨³é‡ï¼Œæ³¨é‡å“è´¨', clubFit: 'æŠ€èƒ½ä¸“å®¶', matchPercent: 88 },
            gemini: { name: 'åŒå­åº§', icon: 'â™Š', personality: 'èªæ˜å¤šå˜ï¼Œå–„äºå­¦ä¹ ', clubFit: 'å­¦ä¹ è¾¾äºº', matchPercent: 92 },
            cancer: { name: 'å·¨èŸ¹åº§', icon: 'â™‹', personality: 'æ¸©å’Œä½“è´´ï¼Œé‡è§†å…³ç³»', clubFit: 'ç¤¾ç¾¤å»ºè®¾è€…', matchPercent: 90 },
            leo: { name: 'ç‹®å­åº§', icon: 'â™Œ', personality: 'è‡ªä¿¡å¤§æ–¹ï¼Œå¤©ç”Ÿé¢†è¢–', clubFit: 'ç ´å±€é¢†è¢–', matchPercent: 96 },
            virgo: { name: 'å¤„å¥³åº§', icon: 'â™', personality: 'ç»†è‡´å®Œç¾ï¼Œè¿½æ±‚ç²¾ç¡®', clubFit: 'è´¨é‡ç®¡æ§å®˜', matchPercent: 89 },
            libra: { name: 'å¤©ç§¤åº§', icon: 'â™', personality: 'ä¼˜é›…å¹³è¡¡ï¼Œå–„äºåè°ƒ', clubFit: 'å…³ç³»åè°ƒå‘˜', matchPercent: 87 },
            scorpio: { name: 'å¤©èåº§', icon: 'â™', personality: 'æ·±æ²‰ä¸“æ³¨ï¼Œæ´å¯ŸåŠ›å¼º', clubFit: 'ç­–ç•¥å¤§å¸ˆ', matchPercent: 94 },
            sagittarius: { name: 'å°„æ‰‹åº§', icon: 'â™', personality: 'è‡ªç”±ä¹è§‚ï¼Œå‹‡äºæ¢ç´¢', clubFit: 'æ¢ç´¢å…ˆé©±', matchPercent: 91 },
            capricorn: { name: 'æ‘©ç¾¯åº§', icon: 'â™‘', personality: 'åŠ¡å®è¿›å–ï¼Œç›®æ ‡æ˜ç¡®', clubFit: 'ç›®æ ‡è¾¾æˆè€…', matchPercent: 93 },
            aquarius: { name: 'æ°´ç“¶åº§', icon: 'â™’', personality: 'åˆ›æ–°ç‹¬ç«‹ï¼Œæ€ç»´è¶…å‰', clubFit: 'AIåˆ›æ–°è€…', matchPercent: 97 },
            pisces: { name: 'åŒé±¼åº§', icon: 'â™“', personality: 'æ„Ÿæ€§æµªæ¼«ï¼Œå¯Œæœ‰æƒ³è±¡', clubFit: 'åˆ›æ„è®¾è®¡å¸ˆ', matchPercent: 86 }
        };

        // ç®€åŒ–çš„æƒ…ä¹¦æ¨¡æ¿
        const letterTemplates = {
            romantic: {
                opening: [
                    'äº²çˆ±çš„ç ´å±€ä¿±ä¹éƒ¨ï¼Œä»{joinTime}ä¸ä½ ç›¸é‡çš„é‚£ä¸€åˆ»èµ·ï¼Œæˆ‘å°±çŸ¥é“æ‰¾åˆ°äº†å±äºè‡ªå·±çš„åœ°æ–¹...',
                    'æœ€çˆ±çš„ç ´å±€å¤§å®¶åº­ï¼Œè‡ªä»{joinTime}åŠ å…¥ä½ ä»¥æ¥ï¼Œæˆ‘çš„ç”Ÿæ´»å‘ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–...'
                ],
                body: [
                    'è¿˜è®°å¾—{unforgettableMemory}å—ï¼Ÿé‚£ä¸€åˆ»æˆ‘æ·±æ·±è¢«éœ‡æ’¼äº†ï¼ŒåŸæ¥å­¦ä¹ å¯ä»¥å¦‚æ­¤æœ‰è¶£ã€‚',
                    'åœ¨è¿™é‡Œï¼Œ{biggestChange}ï¼Œè®©æˆ‘é‡æ–°è®¤è¯†äº†è‡ªå·±çš„æ½œåŠ›ã€‚',
                    '{confessionWords}',
                    'æ„Ÿè°¢ä½ ç»™äº†æˆ‘ä¸€ä¸ªå…¨æ–°çš„ä¸–ç•Œï¼Œè®©æˆ‘åœ¨AIçš„æµ·æ´‹ä¸­è‡ªç”±é¨æ¸¸ã€‚'
                ],
                ending: [
                    'æ„¿æˆ‘ä»¬ä¸€èµ·åœ¨ç ´å±€çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œï¼Œåˆ›é€ å±äºæˆ‘ä»¬çš„ä¼ å¥‡ï¼â¤ï¸',
                    'æ­¤ç”Ÿæœ‰å¹¸é‡è§ä½ ï¼Œç ´å±€ä¿±ä¹éƒ¨ï¼Œæˆ‘çˆ±ä½ ï¼ğŸ’•'
                ]
            },
            grateful: {
                opening: [
                    'æ„Ÿæ©é‡è§ç ´å±€ä¿±ä¹éƒ¨ï¼Œ{joinTime}é‚£ä¸ªå†³å®šæ”¹å˜äº†æˆ‘çš„äººç”Ÿè½¨è¿¹...',
                    'äº²çˆ±çš„ç ´å±€å®¶äººä»¬ï¼Œ{joinTime}çš„ç›¸é‡æ˜¯æˆ‘ä»Šå¹´æœ€æ­£ç¡®çš„å†³å®š...'
                ],
                body: [
                    'ç‰¹åˆ«æ„Ÿè°¢{unforgettableMemory}ï¼Œé‚£ä¸ªç»å†è®©æˆ‘æ˜ç™½äº†ä»€ä¹ˆå«åšçœŸæ­£çš„æˆé•¿ã€‚',
                    'è¿™æ®µæ—¶é—´{biggestChange}ï¼Œæˆ‘å‘ç°è‡ªå·±å˜å¾—æ›´åŠ è‡ªä¿¡å’Œå¼ºå¤§ã€‚',
                    '{confessionWords}',
                    'æ¯ä¸€æ¬¡çš„å­¦ä¹ éƒ½æ˜¯ä¸€æ¬¡èœ•å˜ï¼Œæ¯ä¸€ä¸ªä¼™ä¼´éƒ½æ˜¯çè´µçš„è´¢å¯Œã€‚'
                ],
                ending: [
                    'æ„Ÿè°¢æ¯ä¸€ä½è€å¸ˆå’ŒåŒå­¦çš„é™ªä¼´ï¼Œè®©è¿™ä¸ªä¸ƒå¤•å˜å¾—å¦‚æ­¤ç‰¹åˆ«ï¼ğŸ™',
                    'ç ´å±€ä¿±ä¹éƒ¨ï¼Œæ„Ÿè°¢ä½ æˆå°±äº†æ›´å¥½çš„æˆ‘ï¼âœ¨'
                ]
            },
            inspiring: {
                opening: [
                    'ç ´å±€ä¿±ä¹éƒ¨çš„ä¼™ä¼´ä»¬ï¼Œ{joinTime}æˆ‘ä»¬ç›¸é‡ï¼Œä»æ­¤è¸ä¸Šäº†å…±åŒæˆé•¿çš„é“è·¯...',
                    'æˆ‘çš„ç ´å±€æˆ˜å‹ä»¬ï¼Œ{joinTime}å¼€å§‹çš„è¿™æ®µæ—…ç¨‹å……æ»¡äº†æŒ‘æˆ˜ä¸æ”¶è·...'
                ],
                body: [
                    'é€šè¿‡{unforgettableMemory}ï¼Œæˆ‘å­¦ä¼šäº†é¢å¯¹å›°éš¾æ—¶çš„åšæŒä¸å‹‡æ°”ã€‚',
                    '{biggestChange}ï¼Œè¿™è®©æˆ‘çœ‹åˆ°äº†æ— é™çš„å¯èƒ½æ€§ã€‚',
                    '{confessionWords}',
                    'æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥ï¼Œä¸€èµ·åˆ›é€ æœªæ¥ã€‚'
                ],
                ending: [
                    'è®©æˆ‘ä»¬ç»§ç»­æºæ‰‹å‰è¡Œï¼Œåœ¨AIçš„ä¸–ç•Œé‡Œé—¯å‡ºä¸€ç‰‡å¤©åœ°ï¼ğŸš€',
                    'ç ´å±€ä¿±ä¹éƒ¨ï¼Œæˆ‘ä»¬ä¸€èµ·åŠ æ²¹ï¼Œæœªæ¥å¯æœŸï¼ğŸ’ª'
                ]
            }
        };

        // å†…ç½®ç”Ÿæˆå‡½æ•°
        function generateLoveLetter() {
            console.log('å†…ç½®generateLoveLetterå‡½æ•°è¢«è°ƒç”¨');
            
            // è·å–ç”¨æˆ·è¾“å…¥
            const constellation = document.getElementById('constellation').value;
            const nickname = document.getElementById('nickname').value;
            const joinTime = document.getElementById('joinTime').value;
            const unforgettableMemory = document.getElementById('unforgettableMemory').value;
            const biggestChange = document.getElementById('biggestChange').value;
            const confessionWords = document.getElementById('confessionWords').value;
            const letterStyle = document.getElementById('letterStyle').value;

            // éªŒè¯è¾“å…¥
            if (!constellation || !nickname || !joinTime || !unforgettableMemory || !biggestChange || !confessionWords || !letterStyle) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ç›®å“¦ï½ ğŸ˜Š');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            const loadingDiv = document.getElementById('loadingDiv');
            if (loadingDiv) {
                loadingDiv.style.display = 'block';
            }
            
            // æ¨¡æ‹ŸåŠ è½½æ—¶é—´
            setTimeout(() => {
                // è·å–æ˜Ÿåº§æ•°æ®
                const constellationInfo = constellationData[constellation];
                const template = letterTemplates[letterStyle];

                // éšæœºé€‰æ‹©æ¨¡æ¿ç‰‡æ®µ
                const opening = template.opening[Math.floor(Math.random() * template.opening.length)];
                const body = template.body.join('\n\n');
                const ending = template.ending[Math.floor(Math.random() * template.ending.length)];

                // æ›¿æ¢å˜é‡
                let loveLetter = (opening + '\n\n' + body + '\n\n' + ending)
                    .replace(/{joinTime}/g, joinTime)
                    .replace(/{unforgettableMemory}/g, unforgettableMemory)
                    .replace(/{biggestChange}/g, biggestChange)
                    .replace(/{confessionWords}/g, confessionWords)
                    .replace(/{nickname}/g, nickname);

                // ç”Ÿæˆè¿åŠ¿å†…å®¹
                const fortuneContent = `
                    <h3>ğŸ”® ${nickname}çš„ç ´å±€ä¿±ä¹éƒ¨è¿åŠ¿</h3>
                    <div style="margin: 20px 0;">
                        <h4 style="color: #6c5ce7; margin-bottom: 10px;">
                            ${constellationInfo.icon} ${constellationInfo.name} Ã— ç ´å±€ä¿±ä¹éƒ¨
                        </h4>
                        <div style="font-size: 24px; font-weight: bold; color: #e17055; margin: 10px 0;">
                            ä¿±ä¹éƒ¨å¥‘åˆåº¦ï¼š${constellationInfo.matchPercent}%
                        </div>
                        <p style="margin-bottom: 15px;">
                            <strong>æ€§æ ¼ç‰¹è´¨ï¼š</strong>${constellationInfo.personality}
                        </p>
                        <p style="margin-bottom: 15px;">
                            <strong>ä¿±ä¹éƒ¨èº«ä»½ï¼š</strong>${constellationInfo.clubFit}
                        </p>
                    </div>
                    <div style="margin: 20px 0; text-align: center; padding: 15px; background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); border-radius: 10px;">
                        <p style="margin-bottom: 10px;"><strong>ğŸ’° ç ´å±€è´¢è¿æç¤º</strong></p>
                        <p>ä¸‹åŠå¹´AIå˜ç°é»„é‡‘æœŸå°†åœ¨9-11æœˆåˆ°æ¥ï¼Œç°åœ¨æ­£æ˜¯åœ¨ä¿±ä¹éƒ¨ç§¯ç´¯æŠ€èƒ½çš„æœ€ä½³æ—¶æœºï¼</p>
                    </div>
                    <div style="margin: 20px 0; text-align: center; padding: 15px; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 10px;">
                        <p style="margin-bottom: 10px;"><strong>â¤ï¸ ä¸ƒå¤•ç‰¹åˆ«ç¥ç¦</strong></p>
                        <p>æ„¿ä½ åœ¨ç ´å±€ä¿±ä¹éƒ¨æ‰¾åˆ°å¿—åŒé“åˆçš„ä¼™ä¼´ï¼Œä¸€èµ·åœ¨AIçš„ä¸–ç•Œé‡Œåˆ›é€ å±äºæˆ‘ä»¬çš„ä¼ å¥‡æ•…äº‹ï¼</p>
                    </div>
                `;

                // æ˜¾ç¤ºç»“æœ
                document.getElementById('loveLetter').innerHTML = `
                    <h2 style="text-align: center; margin-bottom: 25px; color: #e17055; font-size: 1.8em;">
                        ğŸ’• ${nickname}çš„ç ´å±€æƒ…ä¹¦ ğŸ’•
                    </h2>
                    <div style="line-height: 2.2; font-size: 17px; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                        ${loveLetter.replace(/\n/g, '<br><br>')}
                    </div>
                    <p style="text-align: right; margin-top: 25px; font-style: italic; color: #636e72; font-size: 16px;">
                        â€”â€” æ¥è‡ª${constellationInfo.name}çš„${nickname} ${constellationInfo.icon}
                    </p>
                `;

                document.getElementById('fortune').innerHTML = fortuneContent;

                // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºç»“æœ
                if (loadingDiv) {
                    loadingDiv.style.display = 'none';
                }
                document.getElementById('inputForm').style.display = 'none';
                document.getElementById('resultContainer').style.display = 'block';

                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                setTimeout(() => {
                    document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
                }, 100);
                
                alert('âœ¨ ä½ çš„ç ´å±€æƒ…ä¹¦å·²ç”Ÿæˆï¼');
            }, 2000);
        }
        
        // é‡æ–°ç”Ÿæˆå‡½æ•°
        function generateAnother() {
            document.getElementById('resultContainer').style.display = 'none';
            document.getElementById('inputForm').style.display = 'block';
            
            // æ»šåŠ¨åˆ°è¡¨å•
            document.getElementById('inputForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        // å…¶ä»–ç®€åŒ–å‡½æ•°
        function generateShareImage() {
            alert('åˆ†äº«åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·æˆªå›¾ä¿å­˜å†…å®¹ ğŸ“±');
        }
        
        function generateLoveLetterImage() {
            alert('é•¿å›¾ç”ŸæˆåŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·æˆªå›¾ä¿å­˜å†…å®¹ ğŸ“·');
        }
        
        function downloadImage() {
            alert('ä¸‹è½½åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·æˆªå›¾ä¿å­˜å†…å®¹ ğŸ’¾');
        }
        
        function downloadLoveLetterImage() {
            alert('ä¸‹è½½åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·æˆªå›¾ä¿å­˜å†…å®¹ ğŸ’¾');
        }
        
        // ==========================================================
        
        // æ³¨å†ŒService Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    console.log('SWæ³¨å†ŒæˆåŠŸ:', registration);
                    
                    // SWæ³¨å†ŒæˆåŠŸåï¼Œå¦‚æœè¿˜æ²¡æœ‰æ˜¾ç¤ºå®‰è£…æç¤ºï¼Œåˆ™æ˜¾ç¤º
                    if (!installPromptShown && !isInStandaloneMode()) {
                        setTimeout(() => {
                            showInstallPrompt();
                        }, 5000);
                    }
                })
                .catch(error => {
                    console.log('SWæ³¨å†Œå¤±è´¥:', error);
                    // å³ä½¿SWæ³¨å†Œå¤±è´¥ï¼Œä¹Ÿå°è¯•æ˜¾ç¤ºå®‰è£…æç¤º
                    if (!installPromptShown && !isInStandaloneMode()) {
                        setTimeout(() => {
                            showInstallPrompt();
                        }, 6000);
                    }
                });
        } else {
            console.log('æµè§ˆå™¨ä¸æ”¯æŒService Worker');
            // ä¸æ”¯æŒSWä¹Ÿæ˜¾ç¤ºå®‰è£…æç¤º
            if (!installPromptShown && !isInStandaloneMode()) {
                setTimeout(() => {
                    showInstallPrompt();
                }, 4000);
            }
        }
    </script>
    
    <script src="script.js"></script>
</body>
</html>